{% extends "admin/index.html" %}


{% block recent_actions  %}
	{% if request.user.is_superuser %}

		<script type="text/javascript" src="http://dygraphs.com/dygraph-combined.js"></script>
		<style type="text/css">
			.few .dygraph-legend > span.highlight { border: 1px solid grey; }

			.many .dygraph-legend > span { display: none; }

			.many .dygraph-legend > span.highlight { display: inline; }
		</style>
		<div id="demo"></div>
		<div id="graphdiv4"
		  style="width:480px; height:320px;"></div>
		<script type="text/javascript">
		   $(document).ready(function () {
		   		var getDataAjax = function(){
		   			$.ajax({
					  dataType: "json",
					  url: '/customgraph',
					  data: data,
					  success: success
					});
		   		};

				var getData = function(numSeries, numRows, isStacked) {
				  var data = [];

				  for (var j = 0; j < numRows; ++j) {
				    data[j] = [j];
				  }
				  for (var i = 0; i < numSeries; ++i) {
				    var val = 0;
				    for (var j = 0; j < numRows; ++j) {
				      if (isStacked) {
				        val = Math.random();
				      } else {
				        val += Math.random() - 0.5;
				      }
				      data[j][i + 1] = [val,0.10];
				    }
				  }
				  return data;
				};

				var makeGraph = function(className, numSeries, numRows, isStacked,data) {
				  var demo = document.getElementById('demo');
				  var div = document.createElement('div');
				  div.className = className;
				  div.style.display = 'inline-block';
				  div.style.margin = '4px';
				  demo.appendChild(div);

				  var labels = ['Date'];
				  if (data){
				  	for (var i = 0; i < data.labels.length; ++i) {
					    var label = '' + data.labels[0];
					    labels[i + 1] = label;
					  }
				  }else{

					  for (var i = 0; i < numSeries; ++i) {
					    var label = '' + i;
					    label = 's' + '000'.substr(label.length) + label;
					    labels[i + 1] = label;
					  }
				  }
				  var dataSource = []
				  if (data){
					dataSource = data.data.map(function(a){return [new Date(a[0]),a[1]] })
				  }else{
				  	dataSource = getData(numSeries, numRows, isStacked)
				  }
				  var g = new Dygraph(
				      div,
				      dataSource,
				      {
				        width: 480,
				        height: 320,
				        labels: labels.slice(),
				        stackedGraph: isStacked,

				        highlightCircleSize: 2,
				        strokeWidth: 1,
				        strokeBorderWidth: isStacked ? null : 1,
				        errorBars: false ,
				        axes: {
				            y: {
				                axisLabelFormatter: function (y,vv,a,b,c) {
				                    return y+ 'Km';
				                },
				                valueFormatter: function (y,vv,a,b,index) {
				                	if (data && data.litros){
				                    	return y+ 'Km - litros: '+data.litros[index];
				                	}else{
				                    	return y+ 'Km - litros:'+index;
				                    }
				                }               
				            }
				        },
				        highlightSeriesOpts: {
				          strokeWidth: 3,
				          strokeBorderWidth: 1,
				          highlightCircleSize: 5
				        }
				      });
				  var onclick = function(ev) {
				    if (g.isSeriesLocked()) {
				      g.clearSelection();
				    } else {
				      g.setSelection(g.getSelection(), g.getHighlightSeries(), true);
				    }
				  };
				  g.updateOptions({clickCallback: onclick}, true);
				  g.setSelection(false, 's005');
				  //console.log(g);
				};
				$.getJSON( "/customgraph?placas=RP001", function( data ) {
		   			
					makeGraph("few", 1, 10, false,data);
					makeGraph("few", 1, 10, true,data);
					makeGraph("many",1, 10, false,data);
					makeGraph("many",1, 10, true,data);
				});
				// makeGraph("few", 1, 10, false);
				// makeGraph("few", 1, 10, true);
				// makeGraph("many",1, 10, false);
				// makeGraph("many",1, 10, true);
				    }
				);
		</script>

		<iframe src="https://jpgraficos.herokuapp.com/caravel/explore/table/1/?x_axis_label=&datasource_name=abastecimento_abastecimento&goto_dash=false&contribution=false&slice_name=Soma+do+Consumo+de+Combust%C3%ADveis+pelo+tempo&show_legend=y&resample_how=&num_period_compare=&since=1+year+ago&y_axis_label=&x_axis_showminmax=y&y_axis_zero=false&flt_op_0=in&viz_type=line&add_to_dash=existing&datasource_type=table&rolling_periods=&time_compare=&userid=1&flt_col_0=combustivel&slice_id=8&x_axis_format=smart_date&show_brush=y&until=now&new_slice_name=&save_to_dashboard_id=1&groupby=combustivel&new_dashboard_name=&flt_eq_0=&rich_tooltip=y&rolling_type=None&rdo_save=overwrite&resample_rule=&y_axis_format=.3s&where=&limit=50&having=&metrics=sum__quantidade&line_interpolation=linear&datasource_id=1&y_log_scale=false&standalone=true&resample_fillmethod=&collapsed_fieldsets=&granularity_sqla=criado_date" width="100%" height="800" seamless frameBorder="0" scrolling="no"></iframe>


		<iframe src="https://jpgraficos.herokuapp.com/caravel/explore/table/1/?donut=y&datasource_name=abastecimento_abastecimento&goto_dash=false&viz_type=pie&show_legend=y&slice_id=9&since=1+year+ago&flt_op_0=in&flt_op_1=in&add_to_dash=existing&datasource_type=table&userid=1&flt_col_0=combustivel&flt_col_1=combustivel&until=now&new_slice_name=Litros+de+Combustivel+-+Rosca&save_to_dashboard_id=1&groupby=combustivel&new_dashboard_name=&flt_eq_1=&flt_eq_0=&slice_name=Litros+de+Combustivel+-+Rosca&rdo_save=saveas&where=&limit=50&having=&metrics=sum__quantidade&datasource_id=1&standalone=true&collapsed_fieldsets=&granularity_sqla=criado_date" width="100%" height="800" seamless frameBorder="0" scrolling="no"></iframe>

	{% endif %}

 {{ block.super }}
{% endblock %}